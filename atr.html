<!doctype html> 
<html> 
<head>
  <title> WebSocket: Echo Server </title> 
  <script> 
      
    var atr='';

    append = function(text)
    {
        document.getElementById("eventi_websocket").insertAdjacentHTML('beforeend', "<li>" + text + "</li>");
    }
  
  /*window.onload = function()
  {
    var echo_service = new WebSocket('ws://localhost:10522'); 
    
    echo_service.onmessage = function(event){
      append("messaggio ricevuto") 
      alert(event.data); 
      echo_service.close();
    } 
    
    echo_service.onopen = function(){
      append("connessione effettuata") 
      echo_service.send("hello!");
    }
    
    echo_service.onclose = function(){
      append("connessione chiusa");
    } 
    
    echo_service.onerror = function(){
      append("errore nella connessione");
    }
  }*/

    function getcode()
    {
      var echo_service = new WebSocket('ws://localhost:10522');

      echo_service.onopen = function()
      {
        append("Get Code: Connected!")
        echo_service.send("Logincode:");
      }

      echo_service.onmessage = function(event)
      {
        append("Get Code message: " + event.data);

        atr = event.data;

        echo_service.close();
      }

      echo_service.onclose = function()
      {
        append("Get Code: Closed!");
      }

      echo_service.onerror = function()
      {
        append("Get Code: Error!");
      }
    }

    function setcode()
    {
      var echo_service = new WebSocket('ws://localhost:10522');

      echo_service.onopen = function()
      {
        append("Get Code: Connected!")
        echo_service.send("Authcode:"+atr);
      }

      echo_service.onmessage = function(event)
      {
        append("Get Code message: " + event.data);

        //atr = event.data;

        echo_service.close();
      }

      echo_service.onclose = function()
      {
        append("Get Code: Closed!");
      }

      echo_service.onerror = function()
      {
        append("Get Code: Error!");
      }
    }

    function checkcode()
    {
      var echo_service = new WebSocket('ws://localhost:10522');

      echo_service.onopen = function()
      {
        append("Get Code: Connected!")
        echo_service.send("Checkcode:");
      }

      echo_service.onmessage = function(event)
      {
        append("Get Code message: " + event.data);

        // atr = event.data;

        echo_service.close();
      }

      echo_service.onclose = function()
      {
        append("Get Code: Closed!");
      }

      echo_service.onerror = function()
      {
        append("Get Code: Error!");
      }
    }

    function checkserver()
    {
      var echo_service = new WebSocket('ws://localhost:10522');

      echo_service.onopen = function()
      {
        append("Get Code: Connected!")

        echo_service.send("Servertype:");
      }

      echo_service.onmessage = function(event)
      {
        append("Check Server message: " + event.data);

        // atr = event.data;

        echo_service.close();
      }

      echo_service.onclose = function()
      {
        append("Get Code: Closed!");
      }

      echo_service.onerror = function()
      {
        append("Get Code: Error!");
      }
    }
  </script> 
</head>

<body>

  <ul id="eventi_websocket"> 
  </ul>

  <button type="button" onclick="getcode()">Get Login Code</button>
  <button type="button" onclick="setcode()">Set Login Code</button>
  <button type="button" onclick="checkcode()">Check Login Code</button>
  <button type="button" onclick="checkserver()">Check Server Type</button>

</body> 
</html>
